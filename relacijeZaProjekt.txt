CREATE DATABASE najam_vozila;

USE najam_vozila;

CREATE TABLE lokacija (
    id SMALLINT NOT NULL AUTO_INCREMENT,
    drzava VARCHAR (47),
    grad VARCHAR (100),
    adresa VARCHAR (100),
    PRIMARY KEY (id)
);

CREATE TABLE pravna_osoba (
    id MEDIUMINT NOT NULL AUTO_INCREMENT, 
    ime VARCHAR (100), 
    identifikacijski_broj VARCHAR (25) NOT NULL UNIQUE,
    id_lokacija SMALLINT,
    PRIMARY KEY (id),
    FOREIGN KEY (id_lokacija) REFERENCES lokacija (id)
);

CREATE TABLE klijent (
    id INT NOT NULL AUTO_INCREMENT,
    ime VARCHAR (30), 
    prezime VARCHAR (30), 
    identifikacijski_broj VARCHAR (13) NOT NULL UNIQUE,
    id_pravna_osoba INT,
    PRIMARY KEY (id),
    FOREIGN KEY (id_pravna_osoba) REFERENCES pravna_osoba (id)
);

CREATE TABLE zanimanje (
    id SMALLINT NOT NULL AUTO_INCREMENT,
    naziv VARCHAR (50) NOT NULL UNIQUE,
    opis_zanimanja TEXT (100) NOT NULL UNIQUE,
    odjel VARCHAR (50) NOT NULL,
    PRIMARY KEY (id),
);

CREATE TABLE zaposlenik (
    id MEDIUMINT NOT NULL AUTO_INCREMENT, 
    id_nadredeni_zaposlenik MEDIUMINT, 
    ime VARCHAR (30) NOT NULL, 
    prezime VARCHAR (30) NOT NULL, 
    identifikacijski_broj VARCHAR (15) NOT NULL UNIQUE,
    spol CHAR (1) CHECK (spol IN ('M', 'F')),
    broj_telefona VARCHAR (20),
    broj_mobitela VARCHAR (20) UNIQUE,
    email VARCHAR (320) UNIQUE,
    id_zanimanje SMALLINT NOT NULL, 
    id_lokacija SMALLINT NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (id_zanimanje) REFERENCES zanimanje (id),
    FOREIGN KEY (id_lokacija) REFERENCES lokacija (id)
);

CREATE TABLE kontakt_klijenta (
    id INT NOT NULL AUTO_INCREMENT, 
    email VARCHAR (320) UNIQUE, 
    broj_mobitela VARCHAR (20) UNIQUE, 
    broj_telefona VARCHAR (20) UNIQUE,
    id_klijent INT,
    PRIMARY KEY (id),
    FOREIGN KEY id_klijent REFERENCES klijent (id) NOT NULL ON DELETE CASCADE
);

CREATE TABLE prihod (
    id TINYINT NOT NULL AUTO_INCREMENT, 
    opis TEXT (200),
    tip_prihoda VARCHAR (25) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE transakcija (
    id BIGINT NOT NULL AUTO_INCREMENT, 
    datum DATE, 
    iznos NUMERIC (12,2), 
    broj_racuna VARCHAR (7), 
    placeno NUMERIC (12,2),
    id_klijent INT,
    id_zaposlenik MEDIUMINT,
    PRIMARY KEY (id),
    FOREIGN KEY (id_klijent) REFERENCES klijent (id),
    FOREIGN KEY (id_zaposlenik) REFERENCES zaposlenik (id)
);

CREATE TABLE prihod_za_zaposlenika (
    id INT NOT NULL AUTO_INCREMENT,
    datum DATE,
    id_transakcija_prihoda BIGINT NOT NULL,
    id_prihod TINYINT NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (id_transakcija_prihoda) REFERENCES transakcija (id) ON DELETE CASCADE,
    FOREIGN KEY (id_prihod) REFERENCES prihod (id)
);

CREATE TABLE popust (
    id TINYINT NOT NULL AUTO_INCREMENT, 
    tip_popusta VARCHAR 40 NOT NULL,
    PRIMARY KEY (id),
);

CREATE TABLE popust_za_klijenta (
    id INT NOT NULL AUTO_INCREMENT,
    datum_primitka DATE, 
    datum_koristenja DATE,
    status VARCHAR (10), 
    id_klijent INT NOT NULL,
    id_popust TINYINT NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (id_klijent) REFERENCES klijent (id) ON DELETE CASCADE,
    FOREIGN KEY (id_popust) REFERENCES popust (id)
);

CREATE TABLE poslovni_trosak (
    id INT NOT NULL AUTO_INCREMENT, 
    id_transakcija_poslovnog_troska BIGINT NOT NULL, 
    svrha VARCHAR (40), 
    opis TEXT (200),
    PRIMARY KEY (id),
    FOREIGN KEY (id_transakcija_poslovnog_troska) REFERENCES transakcija (id) ON DELETE CASCADE
);

CREATE TABLE gotovinsko_placanje (
    id BIGINT NOT NULL, 
    PRIMARY KEY (id) REFERENCES transakcija (id)
);

CREATE TABLE karticno_placanje (
    id BIGINT NOT NULL, 
    tip_kartice VARCHAR (20), 
    id_pravna_osoba_banka MEDIUMINT, 
    PRIMARY KEY (id) REFERENCES transakcija (id),
    FOREIGN KEY (id_pravna_osoba_banka) REFERENCES pravna_osoba (id)
);

CREATE TABLE kriptovalutno_placanje (
    id BIGINT NOT NULL, 
    kriptovaluta VARCHAR (50) NOT NULL, 
    broj_kripto_novcanika VARCHAR (60) NOT NULL,
    PRIMARY KEY (id) REFERENCES transakcija (id)
);

CREATE TABLE kontakt_pravne_osobe (
    id INT NOT NULL AUTO_INCREMENT, 
    email VARCHAR (320) UNIQUE, 
    broj_mobitela VARCHAR (20) , 
    broj_telefona VARCHAR (20),
    opis VARCHAR (100),
    id_pravna_osoba MEDIUMINT NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY id_pravna_osoba REFERENCES pravna_osoba (id) ON DELETE CASCADE
);

CREATE TABLE vozilo (
    id INT NOT NULL AUTO_INCREMENT,
    godina_proizvodnje CHAR(4), 
    registracijska_tablica VARCHAR (15) NOT NULL, 
    tip_punjenja VARCHAR (10),
    duljina NUMERIC (4, 2),
    visina NUMERIC (3, 2),
    nosivost NUMERIC (5, 2),
    id_serija SMALLINT,
    tip_vozila CHAR (1) CHECK (tip_vozila IN ('K', 'M', 'A')),
    PRIMARY KEY (id),
    FOREIGN KEY (id_serija) REFERENCES serija (id)
);

CREATE TABLE najam_vozila (
    id INT NOT NULL AUTO_INCREMENT, 
    id_transakcija_najam BIGINT NOT NULL, 
    id_vozilo INT NOT NULL,
    datum_pocetka DATE, 
    datum_zavrsetka DATE, 
    status VARCHAR (15) NOT NULL,
    pocetna_kilometraza NUMERIC (10, 2), 
    zavrsna_kilometraza NUMERIC (10, 2), 
    PRIMARY KEY (id),
    FOREIGN KEY (id_transakcija_najam) REFERENCES transakcija (id) ON DELETE CASCADE,
    FOREIGN KEY (id_vozilo) REFERENCES vozilo (id)
);

CREATE TABLE serija (
    id SMALLINT NOT NULL AUTO_INCREMENT, 
    ime VARCHAR (100) NOT NULL UNIQUE, 
    proizvodac VARCHAR (40), 
    tip_mjenjaca VARCHAR (10), 
    broj_sjedala,
    broj_vrata TINYINT,
    PRIMARY KEY (id),
);

CREATE TABLE slika_vozila (
    id INT NOT NULL AUTO_INCREMENT, 
    id_vozilo MEDIUMINT NOT NULL, 
    slika MEDIUMBLOB,
    pozicija VARCHAR (30),
    PRIMARY KEY (id),
    FOREIGN KEY (id_vozilo) REFERENCES vozilo (id) ON DELETE CASCADE
);

CREATE TABLE tip_osiguranja (
    id SMALLINT NOT NULL AUTO_INCREMENT,
    id_osiguravajuca_kuca MEDIUMINT,
    tip_osiguranja VARCHAR (20),
    PRIMARY KEY (id),
    FOREIGN KEY (id_osiguravajuca_kuca) REFERENCES pravna_osoba (id)
);

CREATE TABLE osiguranje (
    id INT NOT NULL AUTO_INCREMENT, 
    id_vozilo MEDIUMINT, 
    id_transakcija BIGINT, 
    id_tip_osiguranja SMALLINT NOT NULL,
    datum_pocetka DATE, 
    datum_zavrsetka DATE, 
    PRIMARY KEY (id),
    FOREIGN KEY (id_vozilo) REFERENCES vozilo (id) ON DELETE CASCADE,
    FOREIGN KEY (id_transakcija) REFERENCES transakcija (id) ON DELETE CASCADE,
    FOREIGN KEY (id_tip_osiguranja) REFERENCES tip_osiguranja (id) ON DELETE CASCADE
);

CREATE TABLE steta (
    id INT NOT NULL AUTO_INCREMENT, 
    tip VARCHAR (7),
    opis TEXT (200),
    PRIMARY KEY (id)
);

CREATE TABLE naknada_stete (
    id INT NOT NULL AUTO_INCREMENT,  
    datum_pocetka DATE, 
    datum_zavrsetka DATE, 
    id_transakcija BIGINT NOT NULL,
    id_osiguranje INT,
    id_steta INT NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (id_transakcija) REFERENCES transakcija (id) ON DELETE CASCADE,
    FOREIGN KEY (id_steta) REFERENCES steta (id) ON DELETE CASCADE,
    FOREIGN KEY (id_osiguranje) REFERENCES osiguranje (id)
);

CREATE TABLE punjenje (
    id INT NOT NULL AUTO_INCREMENT,
    id_transakcija_punjenje BIGINT NOT NULL,
    id_vozilo MEDIUMINT NOT NULL,
    kolicina NUMERIC(7, 3),
    tip_punjenja VARCHAR (10),
    PRIMARY KEY (id),
    FOREIGN KEY (id_transakcija_punjenje) REFERENCES transakcija (id) ON DELETE CASCADE,
    FOREIGN KEY (id_vozilo) REFERENCES vozilo (id) ON DELETE CASCADE
);

CREATE TABLE odrzavanje (
    id INT NOT NULL AUTO_INCREMENT, 
    tip odrzavanja VARCHAR (100), 
    id_transakcija_odrzavanje BIGINT NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (id_transakcija_odrzavanje) REFERENCES transakcija (id) ON DELETE CASCADE
);

CREATE TABLE rezervacija (
    id INT NOT NULL AUTO_INCREMENT, 
    datum_rezervacije DATE, 
    datum_potvrde DATE, 
    id_klijent INT NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (id_klijent) REFERENCES klijent (id) ON DELETE CASCADE
);

CREATE TABLE oprema (
    id SMALLINT NOT NULL AUTO_INCREMENT,
    naziv VARCHAR (30),
    opis TEXT (200),
    PRIMARY KEY (id)
);

CREATE TABLE oprema_na_najmu (
    id INT NOT NULL AUTO_INCREMENT,
    id_najam_vozila INT NOT NULL,
    id_oprema SMALLINT NOT NULL,
    kolicina TINYINT,
    PRIMARY KEY (id),
    FOREIGN KEY (id_najam_vozila) REFERENCES najam_vozila (id) ON DELETE CASCADE,
    FOREIGN KEY (id_oprema) REFERENCES oprema (id)
);

CREATE TABLE oprema_na_rezervaciji (
    id INT NOT NULL AUTO_INCREMENT,
    id_rezervacija INT NOT NULL,
    id_oprema INT NOT NULL,
    kolicina TINYINT,
    PRIMARY KEY (id),
    FOREIGN KEY (id_rezervacija) REFERENCES rezervacija (id) ON DELETE CASCADE,
    FOREIGN KEY (id_oprema) REFERENCES oprema (id)
)

CREATE TABLE vozilo_na_rezervaciji (
    id INT NOT NULL AUTO_INCREMENT,
    id_rezervacija INT NOT NULL,
    id_vozilo MEDIUMINT NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (id_rezervacija) REFERENCES rezervacija (id) ON DELETE CASCADE,
    FOREIGN KEY (id_vozilo) REFERENCES vozilo (id),
)

CREATE TABLE crna_lista (
    id SMALLINT NOT NULL AUTO_INCREMENT,
    id_klijent INT NOT NULL,
    razlog TEXT CHECK (LENGTH(razlog) > 30),
    PRIMARY KEY (id),
    FOREIGN KEY (id_klijent) REFERENCES klijent (id) ON DELETE CASCADE
)

